<!DOCTYPE html>

<html lang="ko"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ë§ì¶¤ ê°„ë³‘ì¸ ì¶”ì²œ</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&amp;family=Noto+Sans+KR:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#136dec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101822",
                        "grade-a": "#28a745",
                        "grade-b": "#007BFF",
                        "grade-c": "#FD7E14",
                    },
                    fontFamily: {
                        "display": ["Lexend", "Noto Sans KR", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="font-display bg-background-light dark:bg-background-dark">
<div class="relative w-full max-w-lg mx-auto flex-col group/design-root overflow-x-hidden">
<!-- Top App Bar -->
<header class="sticky top-0 z-10 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm">
<div class="flex items-center p-4 pb-2 justify-between">
<div class="flex size-12 shrink-0 items-center justify-start">
<span class="material-symbols-outlined text-gray-800 dark:text-gray-200">arrow_back</span>
</div>
<h1 class="text-gray-900 dark:text-gray-100 text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center">ë‹¹ì‹ ì„ ìœ„í•œ ë§ì¶¤ ê°„ë³‘ì¸</h1>
<div class="flex w-12 items-center justify-end">
<button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 w-10 bg-transparent text-gray-800 dark:text-gray-200">
<span class="material-symbols-outlined">help_outline</span>
</button>
</div>
</div>
</header>
<main class="flex-1">
<!-- Chips / Filters -->
<div class="sticky top-[72px] z-10 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm px-4 pt-2 pb-3">
<div class="flex gap-2 overflow-x-auto pb-1">
<button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-gray-700 pl-4 pr-3 border border-gray-200 dark:border-gray-600">
<p class="text-gray-800 dark:text-gray-200 text-sm font-medium leading-normal">ì¼€ì–´ ë ˆë²¨</p>
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400 text-base">expand_more</span>
</button>
<button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-gray-700 pl-4 pr-3 border border-gray-200 dark:border-gray-600">
<p class="text-gray-800 dark:text-gray-200 text-sm font-medium leading-normal">ê±°ë¦¬</p>
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400 text-base">expand_more</span>
</button>
<button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-white dark:bg-gray-700 pl-4 pr-3 border border-gray-200 dark:border-gray-600">
<p class="text-gray-800 dark:text-gray-200 text-sm font-medium leading-normal">ê°€ê²©ëŒ€</p>
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400 text-base">expand_more</span>
</button>
<button class="flex h-9 shrink-0 items-center justify-center gap-x-2 rounded-full bg-primary/10 text-primary pl-4 pr-3 border border-primary/30">
<p class="text-sm font-medium leading-normal">ìµœì í•©ìˆœ</p>
<span class="material-symbols-outlined text-base">expand_more</span>
</button>
</div>
</div>
<!-- Caregiver List -->
<div class="flex flex-col gap-4 p-4">
<!-- Recommendations Container -->
<div id="recommendationsContainer" class="flex flex-col gap-4 p-4">
  <!-- Loading State -->
  <div id="loadingState" class="text-center py-8">
    <p class="text-gray-600 dark:text-gray-400">ì¶”ì²œ ê°„ë³‘ì¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>
</div>

<!-- Template: Card 1 -->
<template id="caregiverCardTemplate">
<div class="flex flex-col items-stretch justify-start rounded-xl shadow-md bg-white dark:bg-gray-800 overflow-hidden">
<div class="p-4 flex flex-col gap-4">
<div class="flex items-start gap-4">
<img class="w-16 h-16 rounded-full object-cover caregiver-photo" src="https://via.placeholder.com/64"/>
<div class="flex-grow">
<p class="text-lg font-bold text-gray-900 dark:text-gray-100 caregiver-name"></p>
<p class="text-sm text-gray-500 dark:text-gray-400 caregiver-info"></p>
<div class="flex items-center gap-1 mt-1">
<span class="material-symbols-outlined text-yellow-500 !text-xl" style="font-variation-settings: 'FILL' 1;">star</span>
<p class="text-sm font-bold text-gray-800 dark:text-gray-200"><span class="caregiver-rating">4.8</span> <span class="font-normal text-gray-500 dark:text-gray-400">(reviews)</span></p>
</div>
</div>
<div class="text-center">
<div class="rounded-lg px-3 py-1 grade-badge">
<p class="font-bold text-sm grade-letter">A</p>
<p class="font-semibold text-lg grade-score">85ì </p>
</div>
</div>
</div>
<div class="grid grid-cols-2 gap-3">
<div class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-700/50 p-3">
<span class="material-symbols-outlined text-primary text-2xl">sentiment_satisfied</span>
<div class="flex flex-col">
<h2 class="text-gray-800 dark:text-gray-200 text-sm font-bold">ê³µê°ë„ ì¼ì¹˜</h2>
<p class="text-gray-500 dark:text-gray-400 text-sm empathy-score">85ì </p>
</div>
</div>
<div class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-700/50 p-3">
<span class="material-symbols-outlined text-primary text-2xl">local_pharmacy</span>
<div class="flex flex-col">
<h2 class="text-gray-800 dark:text-gray-200 text-sm font-bold">ì˜ë£Œ ê¸°ìˆ </h2>
<p class="text-gray-500 dark:text-gray-400 text-sm care-score">92ì </p>
</div>
</div>
<div class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-700/50 p-3">
<span class="material-symbols-outlined text-primary text-2xl">forum</span>
<div class="flex flex-col">
<h2 class="text-gray-800 dark:text-gray-200 text-sm font-bold">ì„±ê²© ì¼ì¹˜</h2>
<p class="text-gray-500 dark:text-gray-400 text-sm personality-score">88ì </p>
</div>
</div>
<div class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-background-light dark:bg-gray-700/50 p-3">
<span class="material-symbols-outlined text-primary text-2xl">volunteer_activism</span>
<div class="flex flex-col">
<h2 class="text-gray-800 dark:text-gray-200 text-sm font-bold">ì¸ë‚´ì‹¬</h2>
<p class="text-gray-500 dark:text-gray-400 text-sm patience-score">75ì </p>
</div>
</div>
</div>
<div class="bg-primary/10 dark:bg-primary/20 p-3 rounded-lg">
<h3 class="text-primary dark:text-blue-300 text-sm font-bold mb-1">ì´ ê°„ë³‘ì¸ì´ ì¶”ì²œë˜ëŠ” ì´ìœ :</h3>
<p class="text-sm text-gray-700 dark:text-gray-300 recommendation-reason"></p>
</div>
</div>
<div class="flex items-center justify-between border-t border-gray-200 dark:border-gray-700 p-3 bg-background-light dark:bg-gray-900/50">
<div class="flex items-center gap-2">
<button class="flex h-9 w-9 cursor-pointer items-center justify-center rounded-full text-gray-500 dark:text-gray-400 hover:bg-red-100 dark:hover:bg-red-900/50 hover:text-red-500">
<span class="material-symbols-outlined">favorite_border</span>
</button>
<button class="flex h-9 w-9 cursor-pointer items-center justify-center rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700">
<span class="material-symbols-outlined">share</span>
</button>
</div>
<div class="flex items-center gap-2">
<button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 text-primary dark:text-blue-300 text-sm font-bold leading-normal hover:bg-primary/10">
<span class="truncate">í”„ë¡œí•„ ë³´ê¸°</span>
</button>
<button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal shadow-sm hover:bg-primary/90">
<span class="truncate">ë§¤ì¹­ ìš”ì²­</span>
</button>
</div>
</div>
<div class="flex items-center justify-between border-t border-gray-200 dark:border-gray-700 p-3 bg-background-light dark:bg-gray-900/50">
<div class="flex items-center gap-2">
<button class="flex h-9 w-9 cursor-pointer items-center justify-center rounded-full text-gray-500 dark:text-gray-400 hover:bg-red-100 dark:hover:bg-red-900/50 hover:text-red-500">
<span class="material-symbols-outlined">favorite_border</span>
</button>
<button class="flex h-9 w-9 cursor-pointer items-center justify-center rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700">
<span class="material-symbols-outlined">share</span>
</button>
</div>
<div class="flex items-center gap-2">
<button onclick="viewProfile(event)" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 text-primary dark:text-blue-300 text-sm font-bold leading-normal hover:bg-primary/10">
<span class="truncate">í”„ë¡œí•„ ë³´ê¸°</span>
</button>
<button onclick="requestMatching(event)" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal shadow-sm hover:bg-primary/90 request-matching-btn">
<span class="truncate">ë§¤ì¹­ ìš”ì²­</span>
</button>
</div>
</div>
</div>
</template>

</main>
</div>

<!-- API Client -->
<script src="../api-client.js"></script>

<!-- Page Scripts -->
<script>
const PATIENT_ID = 1; // Default patient ID
const RECOMMENDATIONS_LIMIT = 5; // Number of recommendations

// Load recommendations on page load
document.addEventListener('DOMContentLoaded', async function() {
  await loadRecommendations();
});

// Load recommendations from API
async function loadRecommendations() {
  const container = document.getElementById('recommendationsContainer');
  const loadingState = document.getElementById('loadingState');

  try {
    // Fetch recommendations from API
    const data = await api.recommendCaregivers(PATIENT_ID, RECOMMENDATIONS_LIMIT);

    // Clear loading state
    container.innerHTML = '';

    // Render each recommendation
    data.recommendations.forEach((recommendation, index) => {
      renderCaregiverCard(container, recommendation, index);
    });

    console.log(`âœ… Loaded ${data.recommendations.length} recommendations`);
  } catch (error) {
    console.error('âŒ Failed to load recommendations:', error);
    loadingState.innerHTML = `<p class="text-red-600 dark:text-red-400">ì¶”ì²œ ê°„ë³‘ì¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>`;
  }
}

// Render a caregiver card using template
function renderCaregiverCard(container, data, index) {
  const template = document.getElementById('caregiverCardTemplate');
  const clone = template.content.cloneNode(true);

  // Get the grade color
  const gradeColor = getGradeColor(data.grade);

  // Populate card data
  const nameEl = clone.querySelector('.caregiver-name');
  const infoEl = clone.querySelector('.caregiver-info');
  const ratingEl = clone.querySelector('.caregiver-rating');
  const badgeEl = clone.querySelector('.grade-badge');
  const scoreEl = clone.querySelector('.grade-score');
  const letterEl = clone.querySelector('.grade-letter');
  const emphEl = clone.querySelector('.empathy-score');
  const careEl = clone.querySelector('.care-score');
  const perEl = clone.querySelector('.personality-score');
  const patEl = clone.querySelector('.patience-score');
  const reasonEl = clone.querySelector('.recommendation-reason');

  // Set values
  nameEl.textContent = `${data.caregiver_name} Â· ê°„ë³‘ì¸`;
  infoEl.textContent = `${data.job_title} Â· ì¦‰ì‹œ ê°€ëŠ¥`;
  ratingEl.textContent = (Math.random() * 0.5 + 4.5).toFixed(1);  // Mock rating
  scoreEl.textContent = `${Math.round(data.matching_score)}ì `;
  letterEl.textContent = data.grade;
  emphEl.textContent = `${Math.round(data.empathy_match)}ì `;
  careEl.textContent = `${Math.round(data.care_compatibility)}ì `;
  perEl.textContent = `${Math.round(data.personality_compatibility)}ì `;
  patEl.textContent = `${Math.round(data.patience_match)}ì `;
  reasonEl.textContent = data.reason.replace(/\*\*/g, '').replace(/\\n/g, '\n').substring(0, 200) + '...';

  // Apply grade color
  badgeEl.className = `rounded-lg px-3 py-1 ${gradeColor}`;

  // Store caregiver data in card for later use
  const cardEl = clone.querySelector('.flex.flex-col.items-stretch');
  cardEl.dataset.caregiverId = data.caregiver_id;
  cardEl.dataset.caregiverName = data.caregiver_name;
  cardEl.dataset.matchingScore = data.matching_score;

  // Append to container
  container.appendChild(clone);
}

// Get grade color classes
function getGradeColor(grade) {
  switch(grade.charAt(0)) {
    case 'A':
      return 'bg-grade-a/10 border border-grade-a/50';
    case 'B':
      return 'bg-grade-b/10 border border-grade-b/50';
    case 'C':
      return 'bg-grade-c/10 border border-grade-c/50';
    default:
      return 'bg-blue-100 border border-blue-300';
  }
}

// Handle profile view
function viewProfile(event) {
  const card = event.target.closest('.flex.flex-col.items-stretch');
  if (card) {
    const caregiverName = card.dataset.caregiverName;
    alert(`í”„ë¡œí•„ ë³´ê¸°: ${caregiverName}\n(ìƒì„¸ í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™ ì˜ˆì •)`);
  }
}

// Handle matching request
async function requestMatching(event) {
  const card = event.target.closest('.flex.flex-col.items-stretch');
  if (!card) return;

  const caregiverId = parseInt(card.dataset.caregiverId);
  const caregiverName = card.dataset.caregiverName;
  const matchingScore = parseFloat(card.dataset.matchingScore);

  try {
    const btn = event.target.closest('button');
    btn.disabled = true;
    btn.textContent = 'ìš”ì²­ ì¤‘...';

    const result = await api.createMatching(PATIENT_ID, caregiverId);

    btn.textContent = 'âœ… ë§¤ì¹­ë¨';
    alert(`ğŸ‰ ${caregiverName}ë‹˜ê³¼ì˜ ë§¤ì¹­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì ìˆ˜: ${matchingScore.toFixed(1)}ì `);
  } catch (error) {
    console.error('âŒ Matching request failed:', error);
    alert(`ì˜¤ë¥˜: ${error.message}`);
    const btn = event.target.closest('button');
    btn.disabled = false;
    btn.textContent = 'ë§¤ì¹­ ìš”ì²­';
  }
}
</script>

</body></html>
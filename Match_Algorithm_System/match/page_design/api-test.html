<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BluedonuLab - API í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .log-box {
      max-height: 400px;
      overflow-y: auto;
      background: #1a1a1a;
      color: #00ff00;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      padding: 12px;
      border-radius: 8px;
    }

    .log-line {
      margin: 4px 0;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .success {
      color: #00ff00;
    }

    .error {
      color: #ff0000;
    }

    .info {
      color: #00ffff;
    }

    button {
      transition: all 0.3s ease;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }
  </style>
</head>
<body class="bg-gray-100">
<div class="min-h-screen p-8">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ§ª BluedonuLab API í…ŒìŠ¤íŠ¸</h1>
      <p class="text-gray-600">FastAPI ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œ í†µí•© í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- Status Card -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h2>
      <div id="statusContainer" class="grid grid-cols-2 gap-4">
        <div class="p-4 bg-gray-50 rounded border-l-4 border-blue-500">
          <p class="text-sm text-gray-600">API ì„œë²„</p>
          <p id="apiStatus" class="text-lg font-bold text-gray-400">í™•ì¸ ì¤‘...</p>
        </div>
        <div class="p-4 bg-gray-50 rounded border-l-4 border-green-500">
          <p class="text-sm text-gray-600">ë°ì´í„°ë² ì´ìŠ¤</p>
          <p id="dbStatus" class="text-lg font-bold text-gray-400">í™•ì¸ ì¤‘...</p>
        </div>
      </div>
    </div>

    <!-- Test Buttons -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ”§ í…ŒìŠ¤íŠ¸</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <button onclick="testHealthCheck()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg">
          1ï¸âƒ£ í—¬ìŠ¤ ì²´í¬
        </button>
        <button onclick="testPersonalityStats()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg">
          2ï¸âƒ£ ì„±í–¥ í†µê³„
        </button>
        <button onclick="testRecommendCaregivers()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg">
          3ï¸âƒ£ ê°„ë³‘ì¸ ì¶”ì²œ
        </button>
        <button onclick="testMatchingHistory()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg">
          4ï¸âƒ£ ë§¤ì¹­ ì´ë ¥
        </button>
      </div>
      <button onclick="clearLogs()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">
        ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°
      </button>
    </div>

    <!-- Log Box -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ ì‹¤í–‰ ë¡œê·¸</h2>
      <div id="logBox" class="log-box">
        <div class="log-line info">âœ… API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨</div>
      </div>
    </div>
  </div>
</div>

<!-- API í´ë¼ì´ì–¸íŠ¸ ë¡œë“œ -->
<script src="api-client.js"></script>

<!-- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  const logBox = document.getElementById("logBox");

  // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
  function addLog(message, type = "info") {
    const line = document.createElement("div");
    line.className = `log-line ${type}`;

    if (type === "success") {
      line.textContent = `âœ… ${message}`;
    } else if (type === "error") {
      line.textContent = `âŒ ${message}`;
    } else if (type === "info") {
      line.textContent = `â„¹ï¸ ${message}`;
    }

    logBox.appendChild(line);
    logBox.scrollTop = logBox.scrollHeight;
  }

  function clearLogs() {
    logBox.innerHTML = '<div class="log-line info">âœ… ë¡œê·¸ ì´ˆê¸°í™”ë¨</div>';
  }

  // 1ï¸âƒ£ í—¬ìŠ¤ ì²´í¬
  async function testHealthCheck() {
    addLog("í—¬ìŠ¤ ì²´í¬ ì‹œì‘...", "info");
    try {
      const result = await api.healthCheck();
      addLog(`API ìƒíƒœ: ${result.status}`, "success");
      document.getElementById("apiStatus").textContent = result.status.toUpperCase();
      document.getElementById("apiStatus").className = "text-lg font-bold text-green-500";
    } catch (error) {
      addLog(`í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨: ${error.message}`, "error");
      document.getElementById("apiStatus").textContent = "ì—°ê²° ì‹¤íŒ¨";
      document.getElementById("apiStatus").className = "text-lg font-bold text-red-500";
    }
  }

  // 2ï¸âƒ£ ì„±í–¥ í†µê³„
  async function testPersonalityStats() {
    addLog("ì„±í–¥ í†µê³„ ì¡°íšŒ ì¤‘...", "info");
    try {
      const result = await api.getPersonalityStats();
      addLog(
        `ì´ í™˜ì: ${result.total_count}ëª…, ì™„ë£Œ: ${result.test_completed_count}ëª…, ì™„ë£Œìœ¨: ${result.completion_rate}%`,
        "success"
      );
      addLog(`í‰ê·  ê³µê°ë„: ${result.average_empathy.toFixed(1)}, í™œë™ì„±: ${result.average_activity.toFixed(1)}`, "success");

      // ì„±í–¥ ë¶„í¬
      const distribution = result.personality_type_distribution;
      const top3 = Object.entries(distribution)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3);
      addLog(`ìƒìœ„ 3 ì„±í–¥: ${top3.map((d) => `${d[0]}(${d[1]}ëª…)`).join(", ")}`, "success");
    } catch (error) {
      addLog(`ì„±í–¥ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, "error");
    }
  }

  // 3ï¸âƒ£ ê°„ë³‘ì¸ ì¶”ì²œ
  async function testRecommendCaregivers() {
    addLog("í™˜ì 1ì—ê²Œ ê°„ë³‘ì¸ 3ëª… ì¶”ì²œ ì¤‘...", "info");
    try {
      const result = await api.recommendCaregivers(1, 3);
      addLog(`ì´ ì¶”ì²œ: ${result.total_recommendations}ëª…`, "success");

      result.recommendations.forEach((rec, idx) => {
        addLog(
          `${idx + 1}ìœ„: ${rec.caregiver_name} (ì ìˆ˜: ${rec.matching_score.toFixed(1)}, ë“±ê¸‰: ${rec.grade})`,
          "success"
        );
      });
    } catch (error) {
      addLog(`ê°„ë³‘ì¸ ì¶”ì²œ ì‹¤íŒ¨: ${error.message}`, "error");
    }
  }

  // 4ï¸âƒ£ ë§¤ì¹­ ì´ë ¥
  async function testMatchingHistory() {
    addLog("í™˜ì 1ì˜ ë§¤ì¹­ ì´ë ¥ ì¡°íšŒ ì¤‘...", "info");
    try {
      const result = await api.getMatchingHistory(1);
      addLog(`ì´ ë§¤ì¹­ ìˆ˜: ${result.total_matchings}ê±´`, "success");

      if (result.matchings.length > 0) {
        result.matchings.slice(0, 3).forEach((matching, idx) => {
          addLog(
            `${idx + 1}. ${matching.caregiver_name} (ì ìˆ˜: ${matching.matching_score.toFixed(1)}, ìƒíƒœ: ${matching.status})`,
            "success"
          );
        });
      } else {
        addLog("ë§¤ì¹­ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.", "info");
      }
    } catch (error) {
      addLog(`ë§¤ì¹­ ì´ë ¥ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, "error");
    }
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í—¬ìŠ¤ ì²´í¬
  window.addEventListener("load", async function () {
    addLog("í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ", "success");
    addLog("API ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...", "info");
    await testHealthCheck();
  });
</script>

</body>
</html>

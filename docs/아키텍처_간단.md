# BluedonuLab 아키텍처 (간단 버전)

## 🏗️ 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          사용자 (User)                                   │
│                 (웹브라우저 / 모바일 앱에서 접속)                        │
└────────────────────────────────┬────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│                        🎨 FRONTEND LAYER                                 │
│                       (클라이언트 / 화면)                               │
│                                                                           │
│  ┌─────────────────────────────────────────────────────┐               │
│  │  React Web App / React Native Mobile App            │               │
│  │  • 환자 프로필 관리                                 │               │
│  │  • 간병인 프로필 관리                               │               │
│  │  • 매칭 요청 & 결과 조회                            │               │
│  │  • 만족도 평가 입력                                 │               │
│  │                                                     │               │
│  │  기술: React, TypeScript, CSS                       │               │
│  └─────────────────────────────────────────────────────┘               │
│                                                                           │
└────────────────────────────────┬────────────────────────────────────────┘
                                 │
                    HTTPS REST API (JSON)
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│                        ⚙️ BACKEND LAYER                                  │
│                      (비즈니스 로직)                                     │
│                                                                           │
│  ┌─────────────────────────────────────────────────────┐               │
│  │  API Server (Node.js / Python FastAPI)              │               │
│  │  • 사용자 인증 (Authentication)                     │               │
│  │  • 환자/간병인 데이터 처리                          │               │
│  │  • 매칭 로직 실행                                   │               │
│  │  • ML 모델 호출                                     │               │
│  │  • 데이터베이스 쿼리                                │               │
│  │                                                     │               │
│  │  기술: Express.js / FastAPI, JWT, REST API         │               │
│  └─────────────────────────────────────────────────────┘               │
│                                                                           │
└────────────────────────────────┬────────────────────────────────────────┘
              │                   │                   │
     SQL Query│          HTTP     │          HTTP     │ HTTP
              │       Request     │        Request    │ Request
              ▼                   ▼                   ▼
        ┌─────────┐         ┌──────────┐      ┌───────────┐
        │          │         │           │      │            │
        │          │         │           │      │            │
        ▼          ▼         ▼           ▼      ▼            ▼
┌──────────────────────┐  ┌──────────────┐  ┌─────────────────────┐
│  💾 DATABASE LAYER   │  │ 🤖 ML LAYER  │  │  📦 STORAGE LAYER   │
│    (데이터 저장)      │  │ (AI/예측)    │  │   (파일 저장)       │
└──────────────────────┘  └──────────────┘  └─────────────────────┘
│                         │                  │
│ ▫ Azure SQL Database   │ ▫ ONNX Runtime   │ ▫ Blob Storage
│                        │                  │
│ ▫ Patients Table       │ ▫ XGBoost Model  │ ▫ Model Files
│ ▫ Caregivers Table     │   (V2/V3)        │ ▫ Logs
│ ▫ Matchings Table      │                  │ ▫ Backups
│ ▫ Feedback Table       │ ▫ Input: 13      │
│                        │   Features       │
│ 기술:                  │                  │ 기술:
│ ▫ T-SQL                │ ▫ Python         │ ▫ Cloud Storage
│ ▫ Transactions         │ ▫ Machine        │ ▫ Redundancy
│ ▫ Backup              │   Learning       │
│                        │                  │
└──────────────────────┘  └──────────────┘  └─────────────────────┘
```

---

## 📊 더 자세한 연결 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                   │
│                     🖥️ FRONTEND (React)                          │
│                   ┌──────────────────────┐                      │
│                   │                      │                      │
│                   │ 사용자 UI 화면       │                      │
│                   │ - 매칭 요청 버튼     │                      │
│                   │ - 결과 표시           │                      │
│                   │                      │                      │
│                   └──────────────────────┘                      │
│                            ▲                                     │
│                            │                                     │
│                      HTTP GET/POST                              │
│              (JSON 형식의 요청/응답)                            │
│                            │                                     │
│                            ▼                                     │
│                   ┌──────────────────────┐                      │
│                   │  Backend Server      │                      │
│                   │  (Express.js)        │                      │
│                   │                      │                      │
│                   │ Route Handler:       │                      │
│                   │ POST /matching/      │                      │
│                   │      predict         │                      │
│                   │                      │                      │
│                   └──────────────────────┘                      │
│                      ▲    ▲    ▲                                 │
│                      │    │    │                                 │
│         SQL Query    │    │    │  HTTP Call                     │
│                      │    │    │                                 │
│         ┌────────────┘    │    └──────────────────┐             │
│         │                 │                       │             │
│         ▼                 ▼                       ▼             │
│    ┌─────────┐       ┌─────────┐          ┌──────────┐        │
│    │  SQL    │       │  File   │          │  ONNX    │        │
│    │Database │       │ System  │          │ Runtime  │        │
│    │         │       │         │          │          │        │
│    │ Patients│       │ Models/ │          │ XGBoost  │        │
│    │ Carers │  │  │Logs   │          │ Model    │        │
│    │Matchings│       │         │          │          │        │
│    │Feedback │       │         │          │ Returns: │        │
│    │         │       │         │          │ Score    │        │
│    └─────────┘       └─────────┘          │(0-100)  │        │
│                                            └──────────┘        │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 매칭 요청 상세 흐름

```
1️⃣ 사용자가 앱에서 "매칭 요청" 클릭
   │
   ├─► Frontend (React)
   │   ├─ 환자 ID: 001
   │   └─ 간병인 ID: 002
   │
   ▼
2️⃣ HTTP POST 요청 전송
   │
   Request: {
     "patient_id": 1,
     "caregiver_id": 2
   }
   │
   ▼
3️⃣ Backend API 수신
   │
   Backend (Express.js)
   │
   ▼
4️⃣ 데이터베이스에서 정보 조회
   │
   ├─► SQL Query to Database
   │   ├─ SELECT * FROM Patients WHERE id=1
   │   └─ SELECT * FROM Caregivers WHERE id=2
   │
   ▼
5️⃣ 특성(Features) 벡터 생성
   │
   13개의 숫자로 변환:
   ├─ empathy_diff: 15.5
   ├─ patience_diff: 10.2
   ├─ activity_diff: 20.1
   ├─ ... (10개 더)
   │
   ▼
6️⃣ ML 모델 호출
   │
   ├─► ONNX Runtime에 특성 전달
   │   └─ POST http://ml-service/predict
   │      [15.5, 10.2, 20.1, ...]
   │
   ▼
7️⃣ XGBoost 모델이 예측
   │
   기계가 학습한 패턴을 따라 계산
   │
   ▼
8️⃣ 결과 반환
   │
   Response: {
     "predicted_satisfaction": 78.5,
     "confidence_range": "±12점"
   }
   │
   ▼
9️⃣ Backend에서 데이터 가공 및 저장
   │
   ├─► Matching Record 생성
   │   └─ INSERT INTO Matchings
   │      (patient_id, caregiver_id,
   │       predicted_score, status)
   │
   ├─► 로그 저장
   │   └─ Blob Storage에 저장
   │
   ▼
🔟 Frontend에 응답 전송
   │
   Response: {
     "matching_id": 12345,
     "predicted_satisfaction": 78.5,
     "recommendation": "Good Match",
     "details": "..."
   }
   │
   ▼
1️⃣1️⃣ 사용자 화면에 결과 표시
   │
   ├─ 점수: 78.5점 ✅
   ├─ 신뢰도: ±12점
   ├─ 추천도: 높음 👍
   │
```

---

## 🔌 기술 스택 마트릭스

```
┌──────────────────┬─────────────────────┬──────────────────────────┐
│ 계층              │ 기술                │ 역할                      │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ Frontend         │ React               │ 사용자 인터페이스         │
│                  │ TypeScript          │ 타입 안정성              │
│                  │ CSS/TailwindCSS     │ 스타일링                │
│                  │ Axios               │ HTTP 통신               │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ Backend          │ Node.js             │ 런타임 환경              │
│                  │ Express.js          │ 웹 프레임워크            │
│                  │ (또는 FastAPI)      │ Python 옵션             │
│                  │ JWT                 │ 인증/보안               │
│                  │ Middleware          │ 요청 처리               │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ Database         │ Azure SQL           │ 관계형 데이터베이스      │
│                  │ T-SQL               │ 쿼리 언어               │
│                  │ Indexes             │ 성능 최적화             │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ ML/AI            │ ONNX Format         │ 크로스 플랫폼 모델       │
│                  │ XGBoost             │ 예측 알고리즘           │
│                  │ Python Runtime      │ 모델 실행               │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ Storage          │ Blob Storage        │ 파일 저장소              │
│                  │ Redundancy          │ 백업 & 복구            │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ Infrastructure   │ Azure App Service   │ 호스팅 환경             │
│                  │ Virtual Network     │ 네트워크 보안           │
│                  │ Load Balancer       │ 부하 분산              │
├──────────────────┼─────────────────────┼──────────────────────────┤
│ Monitoring       │ Application         │ 성능 모니터링           │
│                  │ Insights            │                        │
│                  │ Azure Monitor       │ 시스템 모니터링        │
└──────────────────┴─────────────────────┴──────────────────────────┘
```

---

## 🚀 배포 구조 (Azure)

```
┌──────────────────────────────────────────────────────────────────────────┐
│                         AZURE CLOUD                                       │
│                                                                            │
│  ┌────────────────┐          ┌─────────────┐         ┌──────────────┐   │
│  │                │          │             │         │              │   │
│  │  🖥️ Frontend   │◄─HTTPS──►│ ⚙️ Backend  │◄─HTTP──►│  🤖 ML Model │   │
│  │   (React App)  │          │   (Node.js) │        │  (ONNX)      │   │
│  │                │          │             │         │              │   │
│  │ Azure App      │          │ Azure App   │         │ Container    │   │
│  │ Service        │          │ Service     │         │ Instance     │   │
│  │                │          │             │         │              │   │
│  └────────────────┘          └──────┬──────┘         └──────────────┘   │
│         ▲                            │                                    │
│         │                   SQL Query│                                   │
│         │                            │                                   │
│         │                            ▼                                   │
│         │                     ┌──────────────┐                          │
│         │                     │  💾 Database │                          │
│         │                     │   (SQL)      │                          │
│         │                     │              │                          │
│         │                     │ Tables:      │                          │
│         │                     │ • Patients   │                          │
│         │                     │ • Caregivers │                          │
│         │                     │ • Matchings  │                          │
│         │                     │ • Feedback   │                          │
│         │                     │              │                          │
│         │                     └──────────────┘                          │
│         │                                                                │
│         │                                    ┌────────────────┐         │
│         │                                    │ 📦 Blob        │         │
│         │                                    │ Storage        │         │
│         │                                    │                │         │
│         │                                    │ • Model Files  │         │
│         └───────────────────────────────────►│ • Logs         │         │
│          (User Response)                     │ • Backups      │         │
│                                              │                │         │
│                                              └────────────────┘         │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    📊 Monitoring                                 │   │
│  │  • Application Insights                                         │   │
│  │  • Performance Metrics                                          │   │
│  │  • Error Logs                                                   │   │
│  │  • Alerts                                                       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                            │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 📱 사용자별 접근 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        BluedonuLab                               │
└─────────────────────────────────────────────────────────────────┘
        │
        ├──────────────────┬──────────────────┬──────────────────┐
        │                  │                  │                  │
        ▼                  ▼                  ▼                  ▼
   ┌─────────┐        ┌─────────┐       ┌──────────┐       ┌─────────┐
   │          │        │          │       │           │       │         │
   │  환자    │        │ 보호자   │       │ 간병인   │       │ 관리자  │
   │  App     │        │  App     │       │  App     │       │ Dashboard
   │          │        │          │       │           │       │         │
   └────┬─────┘        └────┬─────┘       └─────┬─────┘       └────┬────┘
        │                   │                   │                  │
        │                   │                   │                  │
        └───────────────────┴───────────────────┴──────────────────┘
                            │
                     HTTPS REST API
                            │
                            ▼
                  ┌──────────────────────┐
                  │  Frontend Server     │
                  │  (React Web App)     │
                  │                      │
                  │  Routing:            │
                  │  • /patient          │
                  │  • /caregiver        │
                  │  • /admin            │
                  │  • /matching         │
                  │  • /feedback         │
                  └──────┬───────────────┘
                         │
                  ┌──────▼───────────┐
                  │  Backend API     │
                  │  (Express.js)    │
                  │                  │
                  │  Endpoints:      │
                  │  /api/patients   │
                  │  /api/caregivers │
                  │  /api/matchings  │
                  │  /api/feedback   │
                  │  /api/predict    │
                  └──────┬───────────┘
                         │
             ┌───────────┼───────────┐
             │           │           │
             ▼           ▼           ▼
         Database      ML Model    Storage
```

---

## 🔄 데이터 흐름 단계별

```
단계 1: 인증
┌─────────────────────────────────────┐
│ 사용자 로그인                        │
├─────────────────────────────────────┤
│ Email/Password 입력                 │
│         ↓                           │
│ Backend 검증                        │
│         ↓                           │
│ JWT Token 발급 ✓                   │
│         ↓                           │
│ 이후 모든 요청에 Token 포함        │
└─────────────────────────────────────┘

단계 2: 데이터 조회
┌─────────────────────────────────────┐
│ Frontend에서 GET /api/patients/{id} │
│         ↓                           │
│ Backend에서 Database 쿼리           │
│         ↓                           │
│ SQL: SELECT * FROM Patients        │
│         ↓                           │
│ JSON으로 변환하여 전송 ✓           │
└─────────────────────────────────────┘

단계 3: 예측 실행
┌─────────────────────────────────────┐
│ POST /api/matching/predict          │
│ Body: {patient_id, caregiver_id}   │
│         ↓                           │
│ Backend에서 특성 벡터 생성         │
│         ↓                           │
│ ML Model에 전송                    │
│         ↓                           │
│ 예측 결과 반환 (만족도 점수)      │
│         ↓                           │
│ Database에 저장                    │
│         ↓                           │
│ Frontend에 JSON 응답 ✓            │
└─────────────────────────────────────┘

단계 4: 피드백 저장
┌─────────────────────────────────────┐
│ POST /api/feedback                  │
│ Body: {matching_id, score, review} │
│         ↓                           │
│ Backend 검증                        │
│         ↓                           │
│ Database에 저장                    │
│         ↓                           │
│ 성공 응답 ✓                        │
└─────────────────────────────────────┘
```

---

## 🎯 요약: 각 계층의 역할

```
Frontend (React)
└─ 무엇: 사용자가 보는 화면
└─ 어디: 사용자의 컴퓨터/휴대폰
└─ 역할: 데이터 입력, 결과 표시
└─ 예: "매칭 요청" 버튼 클릭 → 화면에 점수 표시

         ↕️ (HTTPS 통신)

Backend (Node.js/Express)
└─ 무엇: 비즈니스 로직 처리
└─ 어디: Azure App Service
└─ 역할: API 제공, 데이터 검증, ML 호출
└─ 예: "매칭 요청"을 받으면 DB에서 데이터 조회 → ML 호출 → 결과 저장

         ↕️ (SQL 쿼리 / HTTP 호출)

Database (Azure SQL) + ML Service (ONNX) + Storage (Blob)
└─ Database: 환자, 간병인, 매칭, 피드백 데이터 저장
└─ ML: 예측 점수 계산
└─ Storage: 모델 파일, 로그 저장
```

---

**문서 작성:** ML Engineering Team
**최종 검토일:** 2025-11-17
**버전:** 1.0
